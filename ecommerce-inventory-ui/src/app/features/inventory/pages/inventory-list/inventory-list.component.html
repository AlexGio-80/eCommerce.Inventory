<div class="inventory-container">
  <div class="inventory-header">
    <h1>Inventory</h1>
    <div class="actions">
      <button mat-raised-button color="primary">
        <mat-icon>add</mat-icon>
        Add Item
      </button>

      <!-- Grid Options Menu -->
      <button mat-icon-button [matMenuTriggerFor]="gridMenu" matTooltip="Grid Options">
        <mat-icon>more_vert</mat-icon>
      </button>
      <mat-menu #gridMenu="matMenu">
        <button mat-menu-item [matMenuTriggerFor]="columnsMenu">
          <mat-icon>view_column</mat-icon>
          <span>Columns</span>
        </button>
        <button mat-menu-item (click)="saveGridState()">
          <mat-icon>save</mat-icon>
          <span>Save Configuration</span>
        </button>
        <button mat-menu-item (click)="resetGridState()">
          <mat-icon>refresh</mat-icon>
          <span>Reset to Defaults</span>
        </button>
      </mat-menu>

      <!-- Columns Sub-Menu -->
      <mat-menu #columnsMenu="matMenu">
        <div class="columns-menu-container" (click)="$event.stopPropagation()">
          <div *ngFor="let col of getAllColumns()" class="column-toggle-item">
            <mat-checkbox [checked]="isColumnVisible(col.field!)" (change)="toggleColumnVisibility(col.field!)">
              {{ col.headerName }}
            </mat-checkbox>
          </div>
        </div>
      </mat-menu>
    </div>
  </div>

  <!-- No loading spinner needed for infinite scroll, grid handles it -->

  <div class="ag-grid-container">
    <ag-grid-angular style="width: 100%; height: 100%;" class="ag-theme-material" [columnDefs]="columnDefs"
      [defaultColDef]="defaultColDef" [gridOptions]="gridOptions" (gridReady)="onGridReady($event)"
      (columnMoved)="onColumnMoved()" (columnVisible)="onColumnVisible()" (cellMouseOver)="onCellMouseOver($event)"
      (cellMouseOut)="onCellMouseOut($event)">
    </ag-grid-angular>
  </div>

  <!-- Fixed Image Preview Panel -->
  <div class="image-preview-panel" *ngIf="previewImage">
    <img [src]="previewImage" alt="Card Preview">
  </div>
</div>